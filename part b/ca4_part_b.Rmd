---
title: "2022 - Data Analytics for Immersive Environments - CA4 - RDBMS & Linear Regression Project"
subtitle: "CA4 Part B - Linear Regression Analysis"
author: "Joe O'Regan"
date: "2023-01-16"
output:
  html_document: default
  pdf_document: default
always_allow_html: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

---

# Repo Link

[https://github.com/joeaoregan/2022_DAIE_CA4_JOR1](https://github.com/joeaoregan/2022_DAIE_CA4_JOR1)

---

```{r setup libraries, include=FALSE}
if(!require("readr"))
  install.packages("readr")
if(!require("dplyr"))
  install.packages("dplyr")
if(!require("ggplot2"))
  install.packages("ggplot2")
if(!require("knitr"))
  install.packages("knitr")
if(!require("kableExtra"))
  install.packages("kableExtra")

library(readr) # read_csv()
library(dplyr) # sample_n()
library(ggplot2) # plot linear regression
library(knitr) # Display data in tables
library(kableExtra) # Format tables
```

# Assumptions (Linear Regression)

1. **Homogeneity of variance (homoscedasticity):** The size of the error in our prediction doesn't change significantly across the values of the independent variable.
2. **Independence of observations:** the observations in the dataset were collected using statistically valid sampling methods, and there are no hidden relationships among observations.
3. **Normality:** The data follows a normal distribution.
4. **The relationship between the independent and dependent variable is linear:** the line of best fit through the data points is a straight line (rather than a curve or some sort of grouping factor).

# Read data from CSV file

```{r read csv file}
data <- read_csv("amalgamated_game_survey_250_2022.csv") # read data from csv
```

# Find usable columns

```{r get numeric columns}
# assumption here is it would be very hard to plot a graph on anything else
# colnames(data) # list of column names
#sapply(data, class)
# str(data) # show column properties, find numeric columns
numeric_cols <- unlist(lapply(data, is.numeric))
numeric_data <- data[ , numeric_cols]
colnames(numeric_data)
```

# Variables

age, avg_monthly_hrs_gaming, avg_years_playing_games, avg_monthly_expenditure_dlc are all numeric fields.

# Normality

## Histogram (Visual check)

Use histograms to visually check for normality. If the histogram is symmetrical/unimodal, then the data is assumed to be normally distributed.

```{r}
hist(data$age, 
     main="Age Frequency",
     xlab = "Age")
hist(data$avg_monthly_hrs_gaming, 
     main="Average Monthly Hours Gaming Frequency",
     xlab="Average Monthly Hours Gaming")
hist(data$avg_years_playing_games, 
     main="Average Years Playing Games Frequency",
     xlab = "Average Years Playing Games")
hist(data$avg_monthly_expenditure_dlc, 
     main="Average Monthly Expenditure DLC Fequency",
     xlab = "Average Monthly Expenditure DLC")
```

## Shapiro-Wilk's test

**null hypothesis:** the data are sampled from a Gaussian distribution.

If the P value is greater than 0.05 the answer is yes.

If the P value is less than or equal to 0.05 the answer is no.

```{r shapiro test}
st_age <- shapiro.test(data$age)
if(st_age$p.value < 0.05) print("nope") else print("yep")

st_hours <- shapiro.test(data$avg_monthly_hrs_gaming)
if(st_hours$p.value < 0.05) print("nope") else print("yep")
st_years <- shapiro.test(data$avg_years_playing_games)
if(st_years$p.value < 0.05) print("nope") else print("yep")
st_bucks <- shapiro.test(data$avg_monthly_expenditure_dlc)
if(st_bucks$p.value < 0.05) print("nope") else print("yep")
```

**Dependent Variable:** avg_monthly_hrs_gaming

**Independent Variable:** avg_monthly_expenditure_dlc
```{r include=FALSE}
# kbl(data)
# kbl(sample_n(data, 200))

# sample_data %>%
#   lm(avg_monthly_hrs_gaming ~ avg_monthly_expenditure_dlc, data = .) %>%
#   summary() # data summary
```

```{r}
sample_data <- sample_n(data, 200) # tibble 200 x 11

# lm() - 
# dependent var. ~ independent var.
mod <- lm(avg_monthly_expenditure_dlc ~ avg_monthly_hrs_gaming, 
          data = sample_data)
summary(mod)

#attributes(mod)
#mod$residuals
# hist(mod$residuals)

plot <- ggplot(data = mod, mapping = aes(x = avg_monthly_hrs_gaming, 
                                 y = avg_monthly_expenditure_dlc)) + 
  # geom_point(alpha = 0.1, color = "blue") # add colours for points
  geom_point() + # plot dataset in a scatter plot
  labs(title = "Relationship between games monthly hours played + DLC expenditure",
       x = "Average Monthly Hours Gaming",
       y = "Average Monthly Expenditure DLC")

# plot + geom_smooth(method = lm, se = FALSE, formula=y~x) # probably this one
# plot + stat_smooth(method = lm, formula = y ~ x, geom = "smooth") # ok
# plot + geom_smooth(method = "loess", se = FALSE, formula=y~x) # curved line

coeff <- coefficients(mod)
coeff
intercept <- coeff[1]
slope <- coeff[2]
slope

plot +
  geom_abline(intercept = intercept, slope = slope, color="blue") # regression line

# + geom_abline(mapping = aes(x = avg_monthly_hrs_gaming, y = avg_monthly_expenditure_dlc), data = mod)

```

# Visually Check Normality QQ Plots

```{r}
car::qqPlot(data$age)
car::qqPlot(data$avg_monthly_hrs_gaming)
car::qqPlot(data$avg_years_playing_games)
car::qqPlot(data$avg_monthly_expenditure_dlc)

qqnorm(data$age)
qqline(data$age)
qqnorm(data$avg_monthly_hrs_gaming)
qqline(data$avg_monthly_hrs_gaming)
qqnorm(data$avg_years_playing_games)
qqline(data$avg_years_playing_games)
qqnorm(data$avg_monthly_expenditure_dlc)
qqline(data$avg_monthly_expenditure_dlc)
```

